<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chỉnh sửa ảnh - Công cụ trực tuyến</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="stylesheet" href="style.css">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZS5G3PWFSD"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HBQE75RM9F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZS5G3PWFSD');
</script>
</head>
<body>

  <!-- Authentication Modal -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="authModalLabel">Chào mừng trở lại</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-2" id="authModalBody">
          
          <!-- Tabs Navigation -->
          <ul class="nav nav-pills nav-fill mb-4" id="authTabNav">
            <li class="nav-item">
              <button class="nav-link active" id="tab-login-btn" onclick="showAuthForm('loginForm')">Đăng nhập</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" id="tab-register-btn" onclick="showAuthForm('registerForm')">Đăng ký</button>
            </li>
          </ul>

          <!-- Login Form -->
          <div id="loginForm" class="auth-form-container">
            <div class="mb-3 input-group">
              <span class="input-group-text"><i class="bi bi-envelope"></i></span>
              <input type="email" class="form-control" id="loginEmail" placeholder="Email của bạn" autocomplete="email">
            </div>
            <div class="mb-3 input-group">
              <span class="input-group-text"><i class="bi bi-lock"></i></span>
              <input type="password" class="form-control" id="loginPassword" placeholder="Mật khẩu" autocomplete="current-password">
            </div>
            
            <button class="btn btn-primary w-100 mb-3" onclick="handleLogin()">Đăng nhập</button>
            
            <div class="text-center">
              <a href="#" class="text-decoration-none small" onclick="showAuthForm('forgotForm')">Quên mật khẩu?</a>
            </div>
            <div id="loginMessage" class="mt-3 text-danger text-center small"></div>
          </div>

          <!-- Register Form -->
          <div id="registerForm" class="auth-form-container hidden">
            <div class="mb-3 input-group">
              <span class="input-group-text"><i class="bi bi-envelope"></i></span>
              <input type="email" class="form-control" id="regEmail" placeholder="Email đăng ký" autocomplete="email">
            </div>
            <div class="mb-3 input-group">
               <span class="input-group-text"><i class="bi bi-lock"></i></span>
              <input type="password" class="form-control" id="regPassword" placeholder="Mật khẩu (có chữ hoa & số)" autocomplete="new-password">
            </div>
            <div class="mb-3 input-group">
               <span class="input-group-text"><i class="bi bi-check-lg"></i></span>
              <input type="password" class="form-control" id="regPasswordConfirm" placeholder="Nhập lại mật khẩu" autocomplete="new-password">
            </div>
            <button class="btn btn-success w-100" onclick="handleRegistrationRequest()">Đăng ký tài khoản</button>
            <div id="registerMessage" class="mt-3 text-danger text-center small"></div>
          </div>
          
          <!-- Register OTP Form -->
          <div id="registerOtpForm" class="auth-form-container hidden">
              <p class="text-muted small text-center mb-4">Mã xác thực đã gửi đến <strong id="registerOtpEmailDisplay"></strong>.<br>Vui lòng kiểm tra email.</p>
              <div class="mb-3 text-center">
                  <input type="text" class="form-control text-center fs-4 letter-spacing-2" id="registerOtpCode" placeholder="000000" maxlength="6" inputmode="numeric" autocomplete="one-time-code">
              </div>
              <button class="btn btn-primary w-100 mb-2" onclick="handleCompleteRegistration()">Xác thực &amp; Hoàn tất</button>
              <button class="btn btn-link w-100 text-decoration-none text-muted small" onclick="showAuthForm('registerForm')">Quay lại</button>
              <div id="registerOtpMessage" class="mt-3 text-center small"></div>
          </div>

          <!-- Forgot Password Form -->
          <div id="forgotForm" class="auth-form-container hidden">
              <p class="text-muted small mb-3">Nhập email của bạn để nhận mã đặt lại mật khẩu.</p>
              <div class="mb-3 input-group">
                  <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                  <input type="email" class="form-control" id="forgotEmail" placeholder="Email của bạn" autocomplete="email">
              </div>
              <button class="btn btn-warning w-100 mb-2 text-white" onclick="handleForgot()">Gửi mã xác thực</button>
              <button class="btn btn-link w-100 text-decoration-none text-muted small" onclick="showAuthForm('loginForm')">Quay lại Đăng nhập</button>
              <div id="forgotMessage" class="mt-3 text-center small"></div>
          </div>

          <!-- Reset Password Form -->
          <div id="resetForm" class="auth-form-container hidden">
              <p class="text-muted small text-center">Nhập mã OTP từ email <strong id="resetEmailDisplay"></strong> và mật khẩu mới.</p>
              <div class="mb-3">
                  <input type="text" class="form-control text-center" id="otpCode" placeholder="Mã OTP" inputmode="numeric" autocomplete="one-time-code">
              </div>
              <div class="mb-3 input-group">
                  <span class="input-group-text"><i class="bi bi-key"></i></span>
                  <input type="password" class="form-control" id="newPassword" placeholder="Mật khẩu mới" autocomplete="new-password">
              </div>
              <button class="btn btn-info w-100 mb-3 text-white" onclick="handleResetPassword()">Đặt lại mật khẩu</button>
              <div id="resetMessage" class="mt-2 text-center small"></div>
               <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-2">
                  <div id="resendOtpContainer" class="text-muted small"></div>
                  <a href="#" class="text-decoration-none small" onclick="showAuthForm('loginForm')">Quay lại</a>
              </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  
  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Đổi mật khẩu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="currentPassword" class="form-label">Mật khẩu hiện tại</label>
            <input type="password" class="form-control" id="currentPassword" autocomplete="current-password">
          </div>
          <div class="mb-3">
            <label for="changeNewPassword" class="form-label">Mật khẩu mới</label>
            <input type="password" class="form-control" id="changeNewPassword" autocomplete="new-password">
          </div>
          <div class="mb-3">
            <label for="confirmNewPassword" class="form-label">Xác nhận mật khẩu mới</label>
            <input type="password" class="form-control" id="confirmNewPassword" autocomplete="new-password">
          </div>
          <div id="changePasswordMessage" class="mt-3"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          <button type="button" class="btn btn-primary" onclick="handleChangePassword()">Lưu thay đổi</button>
        </div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="../">Home</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="mainNavItems">
          <li class="nav-item">
            <a class="nav-link" href="../qrcode/index.html">Công cụ QR Code</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Chỉnh sửa ảnh</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../bhxh1lan/index.html">Tính BHXH 1 lần</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../huutri/index.html">Tính Hưu trí</a>
          </li>
        </ul>
        <div class="d-flex align-items-center ms-auto">
          <div id="userActions">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-3">
     <div class="hinhanh-app-wrapper">
       <div class="app-container">
          <main class="main-content">
            <div id="uploader" class="uploader-section">
              <label for="upload-input" class="upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                <span>Nhấp để tải lên hoặc kéo &amp; thả</span>
              </label>
              <input type="file" id="upload-input" accept="image/*,.heic,.heif" class="hidden" />
            </div>
            <div id="editor" class="editor-section hidden">
              <div class="canvas-container"><canvas id="canvas"></canvas></div>
              <aside class="controls-panel">
                <div class="controls-main">
                  <nav class="tabs">
                    <button class="tab-btn active" data-tab="resize">Đổi kích thước</button>
                    <button class="tab-btn" data-tab="crop">Cắt ảnh</button>
                    <button class="tab-btn" data-tab="rotate">Xoay</button>
                    <button class="tab-btn" data-tab="censor">Làm mờ</button>
                    <button class="tab-btn" data-tab="export">Xuất ảnh</button>
                  </nav>
                  <div id="resize-controls" class="tab-content active"><h3>Đổi kích thước ảnh</h3><div class="control-group"><label for="width-input">Rộng:</label><input type="number" id="width-input" min="1" /></div><div class="control-group"><label for="height-input">Cao:</label><input type="number" id="height-input" min="1" /></div><div class="control-group checkbox-group"><input type="checkbox" id="aspect-ratio-lock" checked><label for="aspect-ratio-lock">Giữ tỷ lệ</label></div><button id="apply-resize-btn" class="action-btn">Áp dụng</button></div>
                  <div id="crop-controls" class="tab-content"><h3>Cắt ảnh</h3><p class="instructions">Kéo các góc/cạnh để đổi kích thước hoặc kéo từ giữa để di chuyển khung cắt.</p><div class="control-group"><label>Tỷ lệ:</label><div class="aspect-ratio-presets"><button class="aspect-btn active" data-ratio="free">Tự do</button><button class="aspect-btn" data-ratio="1,1">Vuông</button><button class="aspect-btn" data-ratio="4,3">4:3</button><button class="aspect-btn" data-ratio="3,4">3:4</button><button class="aspect-btn" data-ratio="16,9">16:9</button><button class="aspect-btn" data-ratio="9,16">9:16</button></div></div><div class="crop-inputs"><div class="control-group"><label for="crop-x">X:</label><input type="number" id="crop-x" /></div><div class="control-group"><label for="crop-y">Y:</label><input type="number" id="crop-y" /></div><div class="control-group"><label for="crop-width">Rộng:</label><input type="number" id="crop-width" /></div><div class="control-group"><label for="crop-height">Cao:</label><input type="number" id="crop-height" /></div></div><button id="apply-crop-btn" class="action-btn" disabled>Áp dụng cắt</button></div>
                  <div id="rotate-controls" class="tab-content"><h3>Xoay ảnh</h3><p class="instructions">Sử dụng thanh trượt để tinh chỉnh góc xoay hoặc các nút để xoay nhanh.</p><div class="control-group"><label for="rotation-slider"><span>Góc xoay (tinh chỉnh):</span> <span id="rotation-value">0</span>°</label><input type="range" id="rotation-slider" min="-45" max="45" step="1" value="0" class="form-range" style="width: 100%;"></div><div class="control-group-row mt-3"><button id="apply-rotate-btn" class="action-btn">Áp dụng xoay</button><button id="reset-rotate-btn" class="action-btn secondary-style">Reset góc xoay</button></div><hr style="margin: 2rem 0;"><div class="control-group-row"><button id="rotate-left-btn" class="action-btn secondary-style">Xoay Trái 90°</button><button id="rotate-right-btn" class="action-btn secondary-style">Xoay Phải 90°</button></div></div>
                  <div id="censor-controls" class="tab-content"><h3>Che thông tin (Pixelate)</h3><p class="instructions">Nhấp và kéo trên ảnh để chọn vùng cần làm mờ.</p><div class="control-group"><label for="pixelate-intensity-slider"><span>Kích thước pixel:</span> <span id="pixelate-value">10</span>px</label><input type="range" id="pixelate-intensity-slider" min="4" max="40" step="2" value="10" /></div><button id="apply-censor-btn" class="action-btn" disabled>Áp dụng làm mờ</button><p class="instructions small-text">Lưu ý: Hành động này sẽ áp dụng hiệu ứng trực tiếp lên ảnh.</p></div>
                  <div id="export-controls" class="tab-content"><h3>Xuất ảnh</h3><div class="control-group"><label for="format-select">Định dạng:</label><select id="format-select"><option value="image/jpeg" selected>JPEG</option><option value="image/png">PNG</option><option value="image/webp">WebP</option></select></div><div class="control-group" id="quality-control"><label for="quality-slider"><span>Chất lượng:</span> <span id="quality-value">1</span></label><input type="range" id="quality-slider" min="0.1" max="1" step="0.05" value="1" /></div><div class="control-group"><p class="file-size-info"><span>Kích thước ước tính:</span> <strong id="estimated-size">...</strong></p></div><button id="download-btn" class="action-btn">Tải ảnh</button></div>
                </div>
                <div class="controls-footer"><div class="history-buttons"><button id="undo-btn" class="secondary-btn" disabled>Hoàn tác</button><button id="redo-btn" class="secondary-btn" disabled>Làm lại</button></div><button id="reset-btn" class="reset-btn">Tải ảnh mới</button></div>
              </aside>
            </div>
          </main>
        </div>
    </div>
    <div class="tool-description mt-5 p-4 bg-light rounded">
      <h2 class="h4">Giới thiệu Trình Chỉnh Sửa Ảnh Online Miễn Phí</h2>
      <p>Trình chỉnh sửa ảnh của chúng tôi cung cấp các công cụ thiết yếu để bạn có thể xử lý hình ảnh một cách nhanh chóng ngay trên trình duyệt mà không cần cài đặt phần mềm. Đây là giải pháp hoàn hảo để thực hiện các thao tác <strong>chỉnh sửa ảnh cơ bản</strong> một cách hiệu quả.</p>
      <h3 class="h5 mt-3">Các tính năng chính:</h3>
      <ul>
        <li><strong>Thay đổi kích thước ảnh:</strong> Dễ dàng điều chỉnh chiều rộng và chiều cao của ảnh theo pixel, có hoặc không giữ tỷ lệ khung hình gốc.</li>
        <li><strong>Cắt ảnh online:</strong> Công cụ <strong>cắt ảnh</strong> linh hoạt với các tỷ lệ đặt trước (vuông, 16:9, 4:3) hoặc cắt tự do để lấy đúng khung hình bạn muốn.</li>
        <li><strong>Xoay và lật ảnh:</strong> Xoay ảnh theo góc tùy chỉnh hoặc xoay nhanh 90 độ, giúp điều chỉnh hướng ảnh một cách chính xác.</li>
        <li><strong>Làm mờ / Che thông tin (Pixelate):</strong> Bảo mật thông tin nhạy cảm như khuôn mặt, biển số xe, hoặc văn bản bằng cách <strong>làm mờ vùng ảnh</strong> bạn chọn.</li>
        <li><strong>Làm giảm dung lượng ảnh:</strong> Giảm dung lương ảnh, xuất ảnh JPEG với dung lượng thấp hơn theo ý muốn.</li>
        <li><strong>Xuất ảnh chất lượng cao:</strong> Lưu tác phẩm của bạn dưới các định dạng phổ biến như PNG, JPEG, hoặc WebP với tùy chọn điều chỉnh chất lượng.</li>
      </ul>
      <p>Với giao diện trực quan và các tính năng mạnh mẽ, công cụ chỉnh sửa ảnh miễn phí này là người bạn đồng hành lý tưởng cho mọi nhu cầu xử lý ảnh hàng ngày.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>
  <script src="../assets/script.js"></script>
  <script src="script.js"></script>
</body>
</html>
